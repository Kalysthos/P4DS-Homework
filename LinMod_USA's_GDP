import pandas as pd
import numpy as np
import functools as f
import data2 as d
from searching_data import data_search
from clean_data import clean_tb

tbs = [clean_tb(df) for df in d.data]
my_indexes_USA = ['Urban population (% of total)',
                  'Domestic credit provided by financial sector (% of GDP)',
                  'Domestic credit to private sector (% of GDP)',
                  'Total reserves (includes gold, current US$)',
                  'Electric power consumption (kWh per capita)']
                  
                  
my_data = [data_search(tbs,'index',i).T[['United States']].T for i in my_indexes_USA]
my_data1 = [df.drop([2015,2016,2017],axis=1) if 2017 in df.columns else df for df in my_data]
my_data2 = [df.drop(columns=['Indicator Name','Country Code','Indicator Code']).T
            if 'Country Code' in df.columns 
            else df.drop(columns=['Indicator Name','Indicator Code']).T 
            for df in my_data1]
maxis=[]
minis=[]
for df in my_data2:
    for country in df.columns:
        if not all(df[country].isna().values):
            maxi = df[country].max()
            maxis.append(maxi)
            mini = df[country].min()
            minis.append(mini)
            df[country] = df[country]-mini
            if maxi != mini:
                df[country] = df[country]/(maxi-mini)

A = np.concatenate([df.values for df in my_data2]+[np.ones([55,1])],axis=1)
b=data_search(tbs,'country','United States')['GDP per capita (current US$)'][:55].values.reshape(-1,1).astype(float)
b=(b-min(b)[0])/max(b-min(b)[0])[0]
b=b.astype(float)

x=np.linalg.solve(np.dot(A.T,A).astype(float),np.dot(A.T,b).astype(float))

          
